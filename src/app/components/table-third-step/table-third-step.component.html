<!-- Producto y puntos de venta -->
<div class="card">
  <div class="card-body">

    <div class="btn-wrapper">
      <button class="btn btn-primary" (click)="goToPreviousStep()">Volver<i
          class="bi bi-arrow-left-circle"></i></button>
      <button class="btn btn-primary" (click)="exportCsv()">Descargar Maestro<i
          class="bi bi-file-earmark-arrow-down"></i></button>
    </div>

    <div class="row">
      <mat-form-field appearance="fill">
        <mat-label>*Maestro</mat-label>
        <mat-select [(ngModel)]="selectedMaster" (ngModelChange)="changeMaster($event)">
          <mat-option selected value="EMPTY" disabled>Seleccionar</mat-option>
          <mat-option value="PV">Puntos de venta</mat-option>
          <mat-option value="PR">Productos</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <mat-divider></mat-divider>

    <app-upload-master-file (masterfile)="handleMasterfile($event)" [configurationDone]="configurationDone"></app-upload-master-file>


    <div class="card">
      <div class="card-body">
        <div class="btn btn-primary" (click)="handleRefresh()">Refrescar<i class="bi bi-arrow-repeat"></i></div>

        <ng-template #noDisponible class="card">
          <div class="card-body">
            No existe informaci√≥n para visualizar
          </div>
        </ng-template>

        <div *ngIf="masterFileCollection?.length || masterFileCollection; else noDisponible">
          <table mat-table *ngIf="dataSource" [dataSource]="dataSource" matSort matSortActive="startDateLoad"
            matSortDirection="desc" class="card-body">

            <ng-container matColumnDef="idMasterFile">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Id</th>
              <td mat-cell *matCellDef="let row">{{ row.idMasterFile }}</td>
            </ng-container>

            <ng-container matColumnDef="startLoadingDate">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha de Inicio de Cargue</th>
              <td mat-cell *matCellDef="let row">
                {{ row.startDateLoad | date: 'd/MMM/y HH:mm' }}</td>
            </ng-container>

            <ng-container matColumnDef="userName">
              <th mat-header-cell *matHeaderCellDef>Usuario</th>
              <td mat-cell *matCellDef="let row">{{ row.userName }}</td>
            </ng-container>

            <ng-container matColumnDef="master">
              <th mat-header-cell *matHeaderCellDef>Master</th>
              <td mat-cell *matCellDef="let row">{{ row.master }}</td>
            </ng-container>

            <ng-container matColumnDef="fileUploaded">
              <th mat-header-cell *matHeaderCellDef>Archivo Subido</th>
              <td mat-cell *matCellDef="let row">{{ row.fileName }}</td>
            </ng-container>

            <ng-container matColumnDef="state.state">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado</th>
              <td mat-cell *matCellDef="let row">{{ row.state.state }}</td>
            </ng-container>
            
            <ng-container matColumnDef="detail">
              <th mat-header-cell *matHeaderCellDef>Detalle Errores</th>
              <td mat-cell *matCellDef="let row" ><span *ngIf="row.detail === 'Descargar Log'" class="clickable" (click)="downloadDetailCsv(row)">{{ row.detail }}</span><span *ngIf="row.detail && row.detail !== 'Descargar Log'">{{ row.detail }}</span><span *ngIf="!row.detail"></span></td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
        <mat-paginator [length]="dataSource?.length" [pageSize]="10" [pageSizeOptions]="[ 10, 20, 30, 40, 50]">
        </mat-paginator>
      </div>
    </div>
  </div>
</div>
